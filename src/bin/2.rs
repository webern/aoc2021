fn main() {
    let pt1_position = go_places_part_1(PUZZLE_INPUT.iter());
    println!("Part 1 final position: {:?}", pt1_position);
    println!("Part 1 answer: {}", pt1_position.silly_answer());
    println!("---------");
    let pt2_position = go_places_part_2(PUZZLE_INPUT.iter());
    println!("Part 2 final position: {:?}", pt2_position);
    println!("Part 2 answer: {}", pt2_position.silly_answer());
}

#[derive(Debug, Default, Clone, Copy, Eq, PartialEq)]
struct Position {
    horizontal: i64,
    depth: i64,
}

impl Position {
    fn silly_answer(&self) -> i64 {
        self.depth * self.horizontal
    }
}

#[derive(Debug, Clone, Copy)]
enum Direction {
    Forward,
    Down,
    Up,
}

impl Default for Direction {
    fn default() -> Self {
        Self::Forward
    }
}
impl<S> From<S> for Direction
where
    S: AsRef<str>,
{
    fn from(s: S) -> Self {
        match s.as_ref() {
            "forward" => Self::Forward,
            "down" => Self::Down,
            _ => Self::Up,
        }
    }
}

#[derive(Debug, Default, Clone)]
struct Command {
    direction: Direction,
    amount: i64,
}

impl<S> From<S> for Command
where
    S: AsRef<str>,
{
    fn from(s: S) -> Self {
        let s = s.as_ref();
        let mut split = s.split(' ');
        Self {
            direction: split
                .next()
                .map(|word| Direction::from(word))
                .unwrap_or_default(),
            amount: split
                .next()
                .map(|number_str| number_str.parse::<i64>().ok().unwrap_or_default())
                .unwrap_or_default(),
        }
    }
}

// Part 1

fn go_places_part_1<C>(iter: impl Iterator<Item = C>) -> Position
where
    C: Into<Command>,
{
    let mut position = Position::default();
    iter.for_each(|c| {
        let command: Command = c.into();
        match command.direction {
            Direction::Forward => position.horizontal += command.amount,
            Direction::Down => position.depth += command.amount,
            Direction::Up => position.depth -= command.amount,
        }
    });

    position
}

#[test]
fn test_part_1() {
    let position = go_places_part_1(TEST_DATA.iter());
    assert_eq!(
        position,
        Position {
            horizontal: 15,
            depth: 10
        }
    );

    assert_eq!(position.silly_answer(), 150);
}

// Part 2

#[derive(Debug, Default, Clone, Copy, Eq, PartialEq)]
struct Submarine {
    aim: i64,
    position: Position,
}

fn go_places_part_2<C>(iter: impl Iterator<Item = C>) -> Position
where
    C: Into<Command>,
{
    let mut submarine = Submarine::default();
    iter.for_each(|c| {
        let command: Command = c.into();
        match command.direction {
            Direction::Forward => {
                submarine.position.horizontal += command.amount;
                submarine.position.depth += submarine.aim * command.amount;
            }
            Direction::Down => submarine.aim += command.amount,
            Direction::Up => submarine.aim -= command.amount,
        }
    });

    submarine.position
}

#[test]
fn test_part_2() {
    let position = go_places_part_2(TEST_DATA.iter());
    assert_eq!(
        position,
        Position {
            horizontal: 15,
            depth: 60
        }
    );

    assert_eq!(position.silly_answer(), 900);
}

#[allow(unused)]
const TEST_DATA: [&str; 6] = [
    "forward 5",
    "down 5",
    "forward 8",
    "up 3",
    "down 8",
    "forward 2",
];

const PUZZLE_INPUT: [&str; 1000] = [
    "forward 4",
    "forward 6",
    "down 8",
    "forward 3",
    "forward 9",
    "down 7",
    "down 7",
    "down 1",
    "forward 1",
    "forward 5",
    "up 4",
    "forward 3",
    "forward 9",
    "forward 5",
    "down 8",
    "forward 6",
    "forward 8",
    "up 4",
    "forward 1",
    "forward 4",
    "up 3",
    "down 2",
    "down 2",
    "up 8",
    "forward 9",
    "down 5",
    "down 6",
    "down 4",
    "forward 1",
    "forward 7",
    "down 1",
    "forward 2",
    "down 7",
    "down 6",
    "forward 3",
    "forward 1",
    "down 7",
    "forward 3",
    "up 7",
    "up 1",
    "forward 6",
    "down 8",
    "down 4",
    "down 1",
    "down 7",
    "forward 9",
    "down 2",
    "forward 9",
    "up 4",
    "down 7",
    "forward 9",
    "forward 9",
    "up 4",
    "up 7",
    "up 2",
    "forward 1",
    "down 9",
    "forward 2",
    "forward 8",
    "forward 5",
    "down 9",
    "forward 5",
    "up 1",
    "forward 8",
    "down 6",
    "down 1",
    "down 1",
    "down 8",
    "down 6",
    "down 4",
    "down 6",
    "forward 7",
    "forward 5",
    "forward 4",
    "up 8",
    "up 4",
    "forward 6",
    "forward 9",
    "forward 6",
    "down 2",
    "up 8",
    "forward 3",
    "forward 8",
    "down 5",
    "forward 1",
    "down 6",
    "down 7",
    "up 4",
    "down 8",
    "forward 6",
    "up 4",
    "forward 7",
    "down 8",
    "down 8",
    "down 2",
    "down 8",
    "up 7",
    "forward 7",
    "forward 6",
    "down 2",
    "forward 9",
    "down 7",
    "down 4",
    "forward 1",
    "up 9",
    "down 6",
    "up 7",
    "down 6",
    "down 2",
    "down 2",
    "forward 3",
    "down 8",
    "forward 4",
    "down 7",
    "down 2",
    "up 8",
    "down 6",
    "forward 2",
    "forward 2",
    "down 6",
    "up 6",
    "down 7",
    "up 5",
    "up 4",
    "up 9",
    "forward 9",
    "forward 7",
    "down 4",
    "down 4",
    "up 5",
    "down 2",
    "forward 3",
    "down 9",
    "down 5",
    "forward 8",
    "up 3",
    "forward 7",
    "forward 9",
    "down 3",
    "forward 1",
    "up 1",
    "forward 5",
    "down 8",
    "down 2",
    "forward 3",
    "down 6",
    "down 8",
    "up 9",
    "down 9",
    "forward 4",
    "up 5",
    "forward 8",
    "forward 7",
    "forward 7",
    "down 3",
    "down 5",
    "forward 8",
    "down 1",
    "down 2",
    "forward 2",
    "up 9",
    "down 3",
    "down 9",
    "forward 2",
    "down 4",
    "up 9",
    "up 3",
    "down 1",
    "down 1",
    "forward 6",
    "down 5",
    "down 9",
    "forward 2",
    "up 5",
    "forward 3",
    "down 1",
    "down 7",
    "forward 1",
    "forward 1",
    "down 7",
    "up 3",
    "up 1",
    "up 6",
    "forward 9",
    "up 1",
    "down 8",
    "down 5",
    "up 6",
    "up 2",
    "down 8",
    "forward 3",
    "forward 1",
    "down 7",
    "up 1",
    "down 9",
    "down 9",
    "up 8",
    "forward 4",
    "up 8",
    "forward 8",
    "down 5",
    "forward 5",
    "forward 2",
    "forward 1",
    "forward 5",
    "down 8",
    "forward 6",
    "forward 8",
    "down 5",
    "forward 8",
    "up 1",
    "up 9",
    "up 7",
    "down 5",
    "down 9",
    "up 4",
    "down 7",
    "up 8",
    "up 3",
    "forward 6",
    "down 9",
    "forward 4",
    "down 4",
    "forward 2",
    "forward 3",
    "down 4",
    "down 5",
    "down 3",
    "forward 9",
    "forward 5",
    "forward 9",
    "forward 4",
    "down 5",
    "down 7",
    "down 5",
    "forward 8",
    "up 5",
    "down 2",
    "forward 3",
    "forward 4",
    "down 5",
    "up 8",
    "forward 5",
    "down 2",
    "up 4",
    "down 5",
    "down 2",
    "forward 1",
    "up 3",
    "down 6",
    "down 8",
    "down 3",
    "forward 1",
    "up 5",
    "forward 1",
    "down 3",
    "forward 4",
    "down 6",
    "forward 8",
    "forward 4",
    "forward 1",
    "down 8",
    "down 2",
    "forward 8",
    "down 5",
    "forward 2",
    "forward 2",
    "down 9",
    "forward 1",
    "forward 8",
    "up 1",
    "forward 1",
    "down 1",
    "down 7",
    "down 4",
    "up 4",
    "down 3",
    "forward 1",
    "forward 9",
    "down 9",
    "up 6",
    "up 8",
    "down 2",
    "down 2",
    "down 3",
    "forward 2",
    "forward 9",
    "down 1",
    "up 9",
    "down 3",
    "down 9",
    "down 1",
    "down 7",
    "forward 9",
    "forward 7",
    "down 5",
    "down 2",
    "down 9",
    "down 2",
    "down 7",
    "up 7",
    "down 2",
    "up 3",
    "up 5",
    "forward 8",
    "up 7",
    "forward 1",
    "down 9",
    "down 9",
    "down 1",
    "forward 6",
    "down 7",
    "up 4",
    "up 4",
    "down 9",
    "up 5",
    "up 8",
    "down 3",
    "down 5",
    "forward 6",
    "up 3",
    "down 8",
    "down 5",
    "forward 9",
    "up 6",
    "forward 9",
    "forward 5",
    "up 6",
    "up 9",
    "down 2",
    "up 5",
    "forward 9",
    "down 1",
    "up 1",
    "down 9",
    "forward 4",
    "forward 4",
    "forward 8",
    "down 5",
    "down 3",
    "down 7",
    "forward 5",
    "down 6",
    "forward 3",
    "down 5",
    "down 5",
    "up 5",
    "forward 8",
    "forward 1",
    "forward 2",
    "forward 6",
    "up 1",
    "down 5",
    "down 4",
    "up 5",
    "forward 3",
    "forward 2",
    "forward 2",
    "forward 2",
    "forward 7",
    "forward 8",
    "down 2",
    "up 8",
    "forward 4",
    "down 4",
    "forward 7",
    "down 6",
    "down 7",
    "forward 5",
    "down 5",
    "forward 1",
    "down 8",
    "forward 6",
    "down 1",
    "forward 3",
    "up 3",
    "down 7",
    "down 2",
    "up 4",
    "down 3",
    "up 2",
    "up 8",
    "down 2",
    "forward 5",
    "forward 3",
    "down 9",
    "down 9",
    "up 2",
    "forward 6",
    "forward 9",
    "down 1",
    "forward 6",
    "down 4",
    "up 2",
    "down 7",
    "down 3",
    "down 3",
    "forward 2",
    "down 5",
    "down 9",
    "down 7",
    "forward 7",
    "forward 9",
    "up 8",
    "down 8",
    "down 3",
    "up 5",
    "down 9",
    "forward 8",
    "forward 8",
    "down 1",
    "forward 5",
    "forward 2",
    "forward 7",
    "down 9",
    "down 7",
    "forward 6",
    "up 9",
    "forward 3",
    "forward 5",
    "up 7",
    "down 9",
    "forward 9",
    "forward 4",
    "forward 5",
    "forward 9",
    "forward 8",
    "forward 1",
    "forward 2",
    "forward 8",
    "down 7",
    "forward 3",
    "up 2",
    "up 7",
    "forward 1",
    "forward 3",
    "forward 9",
    "up 3",
    "down 2",
    "forward 3",
    "forward 6",
    "forward 3",
    "forward 3",
    "forward 3",
    "forward 1",
    "forward 1",
    "up 5",
    "down 5",
    "up 5",
    "down 5",
    "down 5",
    "forward 8",
    "forward 1",
    "down 4",
    "forward 7",
    "down 6",
    "down 1",
    "down 2",
    "down 2",
    "down 6",
    "up 8",
    "forward 3",
    "forward 2",
    "up 8",
    "up 2",
    "forward 1",
    "forward 6",
    "forward 5",
    "forward 6",
    "forward 7",
    "down 8",
    "forward 1",
    "down 4",
    "forward 2",
    "up 4",
    "forward 4",
    "down 1",
    "forward 5",
    "down 7",
    "forward 7",
    "up 7",
    "forward 1",
    "down 2",
    "forward 8",
    "forward 5",
    "up 8",
    "up 8",
    "up 2",
    "down 9",
    "forward 2",
    "down 4",
    "down 3",
    "down 5",
    "down 5",
    "down 2",
    "up 5",
    "forward 6",
    "up 7",
    "forward 8",
    "up 7",
    "down 4",
    "forward 1",
    "down 3",
    "forward 2",
    "forward 1",
    "down 2",
    "up 7",
    "forward 5",
    "up 8",
    "up 1",
    "down 4",
    "forward 6",
    "down 4",
    "up 9",
    "forward 5",
    "down 2",
    "down 7",
    "down 7",
    "forward 4",
    "forward 4",
    "forward 9",
    "down 1",
    "forward 6",
    "forward 1",
    "up 9",
    "forward 4",
    "forward 4",
    "forward 8",
    "forward 3",
    "forward 4",
    "down 3",
    "up 5",
    "up 1",
    "forward 3",
    "down 6",
    "down 4",
    "down 2",
    "forward 3",
    "forward 8",
    "up 6",
    "up 3",
    "forward 8",
    "down 3",
    "down 6",
    "forward 1",
    "up 7",
    "down 4",
    "down 5",
    "up 7",
    "forward 3",
    "up 4",
    "forward 9",
    "forward 6",
    "down 3",
    "forward 4",
    "down 6",
    "forward 1",
    "forward 6",
    "forward 4",
    "forward 2",
    "forward 1",
    "forward 3",
    "forward 1",
    "down 1",
    "down 9",
    "down 5",
    "down 7",
    "down 4",
    "down 8",
    "up 1",
    "down 6",
    "down 1",
    "forward 4",
    "down 9",
    "up 9",
    "down 6",
    "forward 6",
    "forward 8",
    "up 7",
    "forward 4",
    "down 3",
    "forward 9",
    "forward 6",
    "forward 8",
    "down 1",
    "up 2",
    "down 2",
    "down 8",
    "forward 4",
    "down 9",
    "down 3",
    "forward 5",
    "down 9",
    "down 4",
    "up 5",
    "down 8",
    "down 4",
    "down 9",
    "up 4",
    "down 5",
    "down 7",
    "down 3",
    "up 1",
    "up 1",
    "down 4",
    "down 6",
    "forward 8",
    "down 8",
    "down 6",
    "forward 6",
    "forward 9",
    "forward 3",
    "forward 3",
    "down 2",
    "down 4",
    "forward 3",
    "up 5",
    "up 3",
    "down 5",
    "down 1",
    "forward 5",
    "forward 7",
    "forward 1",
    "forward 4",
    "forward 5",
    "forward 1",
    "down 7",
    "down 8",
    "up 9",
    "down 8",
    "down 5",
    "up 3",
    "down 5",
    "down 5",
    "forward 8",
    "down 2",
    "forward 7",
    "forward 7",
    "down 1",
    "forward 2",
    "forward 7",
    "forward 5",
    "down 6",
    "forward 5",
    "down 5",
    "forward 4",
    "down 8",
    "forward 7",
    "up 5",
    "forward 5",
    "down 7",
    "down 7",
    "up 4",
    "forward 8",
    "up 1",
    "forward 3",
    "forward 7",
    "down 2",
    "forward 1",
    "down 4",
    "up 8",
    "forward 3",
    "forward 1",
    "forward 6",
    "forward 3",
    "up 4",
    "forward 3",
    "down 3",
    "forward 7",
    "forward 9",
    "forward 8",
    "down 6",
    "down 8",
    "up 6",
    "down 9",
    "forward 7",
    "forward 1",
    "up 4",
    "forward 5",
    "forward 8",
    "down 7",
    "down 9",
    "up 6",
    "up 6",
    "forward 9",
    "down 1",
    "forward 8",
    "down 9",
    "down 5",
    "forward 6",
    "forward 1",
    "down 4",
    "forward 8",
    "down 9",
    "down 4",
    "forward 5",
    "forward 7",
    "forward 3",
    "down 2",
    "forward 6",
    "forward 3",
    "forward 8",
    "down 1",
    "down 5",
    "up 6",
    "down 2",
    "down 1",
    "up 3",
    "down 7",
    "up 1",
    "forward 8",
    "down 6",
    "down 6",
    "forward 8",
    "up 3",
    "forward 8",
    "up 3",
    "forward 3",
    "forward 7",
    "forward 1",
    "down 1",
    "up 5",
    "forward 5",
    "forward 9",
    "forward 5",
    "forward 1",
    "forward 4",
    "down 8",
    "forward 2",
    "up 3",
    "forward 3",
    "down 9",
    "forward 2",
    "forward 6",
    "forward 3",
    "up 8",
    "up 1",
    "down 6",
    "forward 3",
    "down 4",
    "down 5",
    "forward 6",
    "forward 9",
    "down 4",
    "down 9",
    "down 7",
    "down 1",
    "up 3",
    "up 6",
    "forward 4",
    "forward 5",
    "down 1",
    "forward 3",
    "up 5",
    "forward 7",
    "down 9",
    "forward 5",
    "down 5",
    "down 1",
    "down 1",
    "down 1",
    "up 8",
    "down 4",
    "down 9",
    "forward 5",
    "down 5",
    "up 5",
    "up 3",
    "forward 1",
    "forward 7",
    "down 2",
    "forward 6",
    "forward 5",
    "up 4",
    "up 4",
    "forward 1",
    "down 7",
    "down 8",
    "up 3",
    "down 3",
    "up 4",
    "forward 2",
    "up 4",
    "up 4",
    "forward 8",
    "forward 1",
    "forward 2",
    "forward 7",
    "down 6",
    "forward 8",
    "forward 9",
    "forward 6",
    "forward 9",
    "down 3",
    "up 3",
    "forward 5",
    "down 1",
    "forward 1",
    "forward 4",
    "forward 2",
    "down 6",
    "up 7",
    "forward 9",
    "down 2",
    "up 5",
    "forward 6",
    "down 9",
    "down 6",
    "down 8",
    "forward 2",
    "down 7",
    "forward 6",
    "down 8",
    "forward 3",
    "forward 7",
    "forward 6",
    "down 7",
    "down 6",
    "forward 5",
    "up 8",
    "forward 6",
    "down 1",
    "up 9",
    "forward 6",
    "down 6",
    "down 5",
    "down 6",
    "up 2",
    "down 3",
    "down 7",
    "down 3",
    "forward 4",
    "up 9",
    "up 2",
    "forward 1",
    "forward 7",
    "forward 7",
    "forward 9",
    "forward 8",
    "forward 7",
    "down 3",
    "forward 4",
    "forward 8",
    "down 9",
    "forward 2",
    "forward 2",
    "up 9",
    "up 7",
    "forward 2",
    "down 8",
    "down 3",
    "down 1",
    "forward 1",
    "forward 3",
    "down 2",
    "forward 7",
    "up 4",
    "down 7",
    "down 1",
    "forward 8",
    "forward 2",
    "up 1",
    "down 5",
    "forward 8",
    "up 5",
    "up 7",
    "forward 4",
    "forward 7",
    "up 4",
    "up 3",
    "forward 5",
    "forward 9",
    "forward 1",
    "forward 3",
    "down 9",
    "up 2",
    "forward 8",
    "down 3",
    "forward 3",
    "forward 2",
    "down 8",
    "down 2",
    "down 3",
    "forward 1",
    "up 7",
    "down 1",
    "forward 3",
    "forward 8",
    "down 3",
    "down 9",
    "up 1",
    "down 9",
    "up 7",
    "up 7",
    "forward 7",
    "forward 7",
    "up 8",
    "down 2",
    "down 7",
    "down 1",
    "forward 5",
    "forward 5",
    "forward 7",
    "down 8",
    "forward 5",
    "down 9",
    "down 8",
    "forward 3",
    "up 9",
    "forward 3",
    "up 6",
    "forward 7",
    "up 7",
    "forward 3",
    "forward 2",
    "down 1",
    "down 4",
    "forward 1",
    "forward 8",
    "up 5",
    "down 5",
    "up 1",
    "down 5",
    "up 1",
    "up 6",
    "forward 5",
    "forward 5",
    "down 3",
    "down 3",
    "forward 2",
    "up 3",
    "up 2",
    "down 6",
    "down 5",
    "down 1",
    "down 1",
    "up 6",
    "forward 2",
    "forward 2",
    "up 4",
    "up 6",
    "up 6",
    "down 8",
    "up 2",
    "forward 4",
    "down 3",
    "forward 3",
    "up 4",
    "down 5",
    "forward 6",
    "forward 7",
    "up 6",
    "down 3",
    "down 7",
    "up 4",
    "down 2",
    "up 2",
    "forward 1",
    "down 8",
    "down 1",
    "down 1",
    "up 9",
    "down 1",
    "down 1",
    "up 1",
    "forward 8",
    "forward 4",
    "down 4",
    "forward 1",
    "down 4",
    "up 7",
    "forward 7",
    "forward 3",
    "down 4",
    "forward 9",
    "forward 1",
    "down 3",
    "down 2",
    "forward 7",
    "up 1",
    "forward 3",
    "up 3",
    "down 3",
    "down 7",
    "up 3",
    "up 4",
    "forward 7",
    "down 2",
    "up 2",
    "down 9",
    "up 1",
    "forward 3",
    "up 8",
    "up 8",
    "down 8",
    "down 1",
    "up 8",
    "up 4",
    "down 6",
    "forward 8",
];
